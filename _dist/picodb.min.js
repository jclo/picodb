/** ****************************************************************************
 * PicoDB v0.12.2
 *
 * A tiny in-memory database (MongoDB like) that stores JSON documents.
 * (you can download it from npm or github repositories)
 * Copyright (c) 2019 jclo <jclo@mobilabs.fr> (http://www.mobilabs.fr/).
 * Released under the MIT license. You may obtain a copy of the License
 * at: http://www.opensource.org/licenses/mit-license.php).
 * ************************************************************************** */
!function(e,t){"use strict";"function"==typeof define&&define.amd?define([""],t):"object"==typeof exports?module.exports=t(e):e.PicoDB=t(e)}(this,function(root){"use strict";var PicoDB,P={},_,Rc,Cd,Qd,Rd,ie,je,Ae;function K(e,t,n){return!(!{}.hasOwnProperty.call(e,t)||"function"!=typeof n)}function da(e,t){var n=t.coordinates[0],r=(e.coordinates[0]-n)*(Math.PI/180),i=t.coordinates[1]*(Math.PI/180),o=e.coordinates[1]*(Math.PI/180);return 6371e3*Math.acos(Math.sin(i)*Math.sin(o)+Math.cos(i)*Math.cos(o)*Math.cos(r))}function ha(e,t){for(var n,r=0,i=0;i<t.length-1;i++)(t[i][1]<=e[1]&&t[i+1][1]>e[1]||t[i][1]>e[1]&&t[i+1][1]<=e[1])&&(n=(e[1]-t[i][1])/(t[i+1][1]-t[i][1]),e[0]<t[i][0]+n*(t[i+1][0]-t[i][0])&&(r+=1));return r%2!=0}function ia(e,t){var n,r,i,o,a;switch(t.type){case"MultiPolygon":for(r=0;r<e.length;r++)for(i=0;i<e[r].length;i++){for(o=0;o<t.coordinates.length;o++){for(n=!1,a=0;a<t.coordinates[o].length;a++)if(ha(e[r][i],t.coordinates[o][a])){n=!0;break}if(n)break}if(!n)return!1}return!0;case"Polygon":for(r=0;r<e.length;r++)for(i=0;i<e[r].length;i++){for(n=!1,o=0;o<t.coordinates.length;o++)if(ha(e[r][i],t.coordinates[o])){n=!0;break}if(!n)return!1}return!0;default:throw new Error('Geo._within: the GeoSpatial $geoWihin operator with a $geometry.type "'+t.type+'" is unknown!')}}function ja(e){switch(e.type){case"Point":return[[e.coordinates]];case"LineString":return[e.coordinates];case"Polygon":return e.coordinates;case"MultiPoint":return[e.coordinates];case"MultiLineString":return e.coordinates;default:throw new Error('Geo._toPolygonCoordinates: the GeoJSON type "'+e.type+'" is not supported!')}}function ra(e,t){switch(e.type){case"Point":return!1;case"LineString":return function(e,t){for(var n,r,i,o,a=0;a<e.coordinates.length;a++){for(o=0;o<t.coordinates.length;o++)if(i=!1,ha(e.coordinates[a],t.coordinates[o])){if(i=n=!0,n&&r)return!0;break}if(!i&&(r=!0,n&&r))return!0}return!1}(e,t);case"Polygon":return function(e,t){for(var n,r,i,o,a,s=0;s<e.coordinates.length;s++)for(o=0;o<e.coordinates[s].length;o++){for(a=0;a<t.coordinates.length;a++)if(i=!1,ha(e.coordinates[s][o],t.coordinates[a])){if(i=n=!0,n&&r)return!0;break}if(!i&&(r=!0,n&&r))return!0}return!1}(e,t);case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":default:return!1}}function sa(e,t,n,r){var i;return void 0===n&&void 0===r||!(n<r)&&(i=da(e,t),(!r||r<=i)&&(!n||i<=n))}function ua(e,t){var n,r,i,o,a,s,c,u,l,f,h=_.keys(t)[0];if(!_.isObject(t))return!1;switch(h){case"$geometry":return function(e,t){switch(e.type){case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":return ia(ja(e),t);case"MultiPolygon":case"GeometryCollection":default:return!1}}(e,t.$geometry);case"$box":return u=e,l=t.$box,f={type:"Polygon",coordinates:[[[l[0][0],l[0][1]],[l[1][0],l[0][1]],[l[1][0],l[1][1]],[l[0][0],l[1][1]]]]},ia(ja(u),f);case"$polygon":return a=e,s=t.$polygon,c={type:"Polygon",coordinates:[s,[s[0][0],s[0][1]]]},ia(ja(a),c);case"$center":return i=e,o=t.$center,Math.sqrt(Math.pow(o[0][0]-i.coordinates[0],2)+Math.pow(o[0][1]-i.coordinates[1],2))<o[1];case"$centerSphere":return n=e,r=t.$centerSphere,Math.sqrt(Math.pow(r[0][0]-n.coordinates[0],2)+Math.pow(r[0][1]-n.coordinates[1],2))<r[1]/Math.PI*180;default:throw new Error('Geo._geoWithin: the GeoSpatial $geoWihin operator "'+h+'" is unknown!')}}function wa(e,t){if(!{}.hasOwnProperty.call(t,"$geometry"))return!1;switch(t.$geometry.type){case"Point":return function(e,t,n,r){switch(e.type){case"Point":return sa(e,t,n,r);default:return!1}}(e,t.$geometry,t.$maxDistance,t.$minDistance);default:return!1}}function xa(t,n){var r;return _.forPropIn(n,function(e){switch(e){case"$geoWithin":r=ua(t,n[e]);break;case"$geoIntersects":r=function(e,t){if(!{}.hasOwnProperty.call(t,"$geometry"))return!1;switch(t.$geometry.type){case"Polygon":return ra(e,t.$geometry);default:throw new Error('Geo._geoIntersects: the GeoSpatial $geoIntersects type "'+t.$geometry.type+'" is not supported!')}}(t,n[e]);break;case"$near":r=wa(t,n[e]);break;case"$nearSphere":r=!1;break;default:throw new Error('Geo._query: the Geo Operator "'+e+'" is unknown!')}}),r}function Uc(e){return{not:function(t){var n,r,i,o,a=["$ne","$nin","$not"],s=[];if(_.contains(_.keys(t),"$or"))for(n=t.$or,i=0;i<n.length;i++)_.forPropIn(n[i],function(e){for(o=0;o<a.length;o++)r=new RegExp('"\\'+a[o]+'":'),JSON.stringify(n[i]).match(r)&&s.push(e)});else _.forPropIn(t,function(e){for(o=0;o<a.length;o++)r=new RegExp('"\\'+a[o]+'":'),JSON.stringify(t[e]).match(r)&&s.push(e)});return 0!==s.length&&s}(e),or:!(!(t=e).$or||!_.isArray(t.$or))&&t.$or};var t}function Wc(e,t){var n;if(!_.isArray(t)&&!_.isObject(t))return e===t;for(n in t)if(!function(e,t,n){switch(n){case"$eq":return e===t;case"$gt":return t<e;case"$gte":return t<=e;case"$lt":return e<t;case"$lte":return e<=t;case"$ne":return e!==t;case"$in":return _.isArray(e)?!_.isEmpty(_.share(t,e)):_.contains(t,e);case"$nin":return _.isArray(e)?_.isEmpty(_.share(t,e)):!_.contains(t,e);case"$not":return!Wc(e,t);case"$exists":return t;case"$geoWithin":return Rc.query(e,{$geoWithin:t});case"$geoIntersects":return Rc.query(e,{$geoIntersects:t});case"$near":return Rc.query(e,{$near:t});case"$nearSphere":return Rc.query(e,{$nearSphere:t});default:throw new Error('Query._isConditionTrue: the operator "'+n+'" is unknown!')}}(e,t[n],n))return;return 1}function Xc(e,t,i){var o,a=0;return function e(t,n){var r;for(r in n)if(0===a&&(o=r),t[r]){if(_.isObject(n[r])&&!_.keys(n[r])[0].match(/^\$/)){if(a+=1,e(t[r],n[r])){if(i.or)return!0}else if(--a,!i.or)return!1}else if(Wc(t[r],n[r])){if(i.or)return!0}else if(!i.or)return!1}else{if(!i.not||!_.contains(i.not,o))return!1;if(i.or)return!0}return!i.or}(e,t)}function De(e,t,n,r,i){var o,a,s,c=[];for(!_.isArray(n)&&_.isObject(n)?c.push(n):c=n,o=[],s=0;s<c.length;s++)if(_.isObject(c[s]))if(c[s]._id){if(function(e,t){for(var n=!0,r=0;r<e.data.length;r++)if(e.data[r]._id===t){n=!1;break}return n}(e,c[s]._id)&&(e.data.push(_.extend({},c[s])),o.push(_.extend({},c[s])),!r.many))break}else if(a=_.token(),e.data.push(_.extend({_id:a},c[s])),o.push(_.extend({_id:a},c[s])),!r.many)break;Ae.fire(t,"change",o),Ae.fire(t,"insert",o),i&&i(null,o)}function $e(e,t,n){var r,i,o;for(r in t)if(!_.isArray(t[r])&&_.isObject(t[r])){if(!(e[r]||"$rename"!==n&&"$unset"!==n&&"$pop"!==n))break;e[r]||(e[r]={}),$e(e[r],t[r],n)}else if(hasOwnProperty.call(t,r))switch(n){case"$inc":"number"==typeof e[r]?e[r]+=t[r]:e[r]=t[r];break;case"$mul":"number"==typeof e[r]?e[r]*=t[r]:e[r]=0;break;case"$rename":e[r]&&(e[t[r]]=e[r],delete e[r]);break;case"$set":_.isArray(t[r])?e[r]=_.clone(t[r]):e[r]=t[r];break;case"$unset":e[r]&&delete e[r];break;case"$min":(!e[r]||"number"==typeof e[r]&&t[r]<e[r])&&(e[r]=t[r]);break;case"$max":(!e[r]||"number"==typeof e[r]&&t[r]>e[r])&&(e[r]=t[r]);break;case"$pop":_.isArray(e[r])&&(1===t[r]?e[r].pop():-1===t[r]&&e[r].shift());break;case"$pullAll":if(_.isArray(e[r])&&_.isArray(t[r]))for(i=0;i<t[r].length;i++)for(o=e[r].length-1;0<=o;o--)e[r][o]===t[r][i]&&e[r].splice(o,1);break;default:throw new Error('Update._apply: the operator "'+n+'" is unknown!')}return e}function bf(e,t){var n=_.keys(t);if(!n[0].match(/^\$/))return function(e,t){for(var n=_.keys(e),r=0;r<n.length;r++)"_id"!==n[r]&&delete e[n[r]];return _.extend(e,t)}(e,t);switch(n[0]){case"$inc":return $e(e,t.$inc,"$inc");case"$mul":return $e(e,t.$mul,"$mul");case"$rename":return $e(e,t.$rename,"$rename");case"$set":return $e(e,t.$set,"$set");case"$unset":return $e(e,t.$unset,"$unset");case"$min":return $e(e,t.$min,"$min");case"$max":return $e(e,t.$max,"$max");case"$currentDate":return function e(t,n){var r,i;for(r in n)!{}.hasOwnProperty.call(n,r)||(i=_.keys(n[r])[0],_.isObject(n[r])&&"$type"!==i?(t[r]||(t[r]={}),e(t[r],n[r])):hasOwnProperty.call(n,r)&&("timestamp"===n[r][i]?t[r]=Date.now():t[r]=(new Date).toISOString()));return t}(e,t.$currentDate);case"$pop":return $e(e,t.$pop,"$pop");case"$pullAll":return $e(e,t.$pullAll,"$pullAll");case"$pull":return function e(t,n){var r,i,o,a,s,c,u;for(r in n)if(_.isObject(n[r])&&!_.isArray(t[r]))t[r]&&e(t[r],n[r]);else if(hasOwnProperty.call(n,r)){if(!t[r]||!_.isArray(t[r]))continue;if("boolean"==typeof n[r]||"number"==typeof n[r]||"string"==typeof n[r]){-1<(a=t[r].indexOf(n[r]))&&t[r].splice(a,1);continue}if(_.isObject(n[r])&&!_.keys(n[r])[0].match(/^\$/)){for(u=t[r].length-1;0<=u&&_.isObject(t[r][u]);u--){for(i in o=!0,n[r])if(t[r][u][i]!==n[r][i]){o=!1;break}o&&t[r].splice(u,1)}continue}if(_.isObject(n[r])){switch(s=_.keys(n[r])[0]){case"$eq":-1<(a=t[r].indexOf(n[r].$eq))&&t[r].splice(a,1);break;case"$gt":for(u=t[r].length-1;0<=u;u--)t[r][u]>n[r].$gt&&t[r].splice(u,1);break;case"$gte":for(u=t[r].length-1;0<=u;u--)t[r][u]>=n[r].$gte&&t[r].splice(u,1);break;case"$lt":for(u=t[r].length-1;0<=u;u--)t[r][u]<n[r].$lt&&t[r].splice(u,1);break;case"$lte":for(u=t[r].length-1;0<=u;u--)t[r][u]<=n[r].$lte&&t[r].splice(u,1);break;case"$ne":for(u=t[r].length-1;0<=u;u--)t[r][u]!==n[r].$ne&&t[r].splice(u,1);break;case"$in":if(!_.isArray(n[r].$in))break;for(u=0;u<n[r].$in.length;u++)-1<(a=t[r].indexOf(n[r].$in[u]))&&t[r].splice(a,1);break;case"$nin":if(!_.isArray(n[r].$nin))break;for(c=[],u=0;u<n[r].$nin.length;u++)-1<(a=t[r].indexOf(n[r].$nin[u]))&&c.push(n[r].$nin[u]);t[r]=_.clone(c);break;default:throw new Error('Update._pull: the operator "'+s+'" is not supported!')}continue}}return t}(e,t.$pull);case"$push":return function e(t,n){var r,i,o,a,s;for(r in n)if({}.hasOwnProperty.call(n,r))if(i=_.keys(n[r]),_.isArray(n[r])||!_.isObject(n[r])||i[0].match(/^\$/)){if(hasOwnProperty.call(n,r)){if(t[r]||(t[r]=[]),"boolean"==typeof n[r]||"number"==typeof n[r]||"string"==typeof n[r]){t[r].push(n[r]);continue}if(_.isArray(n[r])){t[r].push(_.clone(n[r]));continue}if(_.isObject(n[r])&&_.isArray(n[r].$each)){for((void 0===(o=n[r].$position)||"number"!=typeof o||o<0)&&(o=t[r].length),void 0!==(a=n[r].$slice)&&"number"==typeof o||(a=null),s=n[r].$each.length-1;0<=s;s--)t[r].splice(o,0,n[r].$each[s]);0<a?t[r].splice(a,t[r].length-a):0===a?t[r].length=0:a<0&&t[r].splice(0,t[r].length+a)}}}else t[r]||(t[r]={}),e(t[r],n[r]);return t}(e,t.$push);default:throw new Error('The Update Operator "'+n[0]+"\" isn't supported!")}}return _={isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isBoolean:function(e){return!0===e||!1===e||"[object Boolean]"===Object.prototype.toString.call(e)},isString:function(e){return"[object String]"===Object.prototype.toString.call(e)},isNumber:function(e){return"[object Number]"===Object.prototype.toString.call(e)},isNaN:function(e){return this.isNumber(e)&&e!==+e},isOdd:function(e){var t=e%2;return e===parseFloat(e)?!!t:void 0},isObject:function(e){var t=typeof e;return("function"==t||"object"==t)&&!!e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},isMath:function(e){return"[object Math]"===Object.prototype.toString.call(e)},isDate:function(e){return"[object Date]"===Object.prototype.toString.call(e)},isEmpty:function(e){var t;if(null===e)return!0;if(this.isArray(e)||this.isString(e))return 0===e.length;for(t in e)if(e.hasOwnProperty(t))return!1;return!0},clone:function(e){var t,n=this.isArray(e)?[]:{};if(this.isObject(e)){for(t in e)this.isArray(e[t])?n[t]=this.clone(e[t]):this.isObject(e[t])?n[t]=this.extend(e[t]):n[t]=e[t];return n}},extend:function(e){var t,n,r;if(!this.isObject(e))return e;for(r=1;r<arguments.length;r++)for(n in t=arguments[r])!this.isArray(arguments[r][n])&&this.isObject(arguments[r][n])?(e[n]=void 0!==e[n]?e[n]:{},this.extend(e[n],arguments[r][n])):hasOwnProperty.call(t,n)&&(e[n]=this.isArray(t[n])?this.clone(t[n]):t[n]);return e},keys:function(e){return Object.keys(e)},forPropIn:function(t,n){this.keys(t).forEach(function(e){!{}.hasOwnProperty.call(t,e)||n(e)})},contains:function(e,t){return-1!==e.indexOf(t)},share:function(e){for(var t,n,r=[],i=0;i<e.length;i++)if(t=e[i],!this.contains(r,t)){for(n=1;n<arguments.length&&this.contains(arguments[n],t);n++);n===arguments.length&&r.push(t)}return r},token:function(){return Math.random().toString(36).substr(2)}},P.Event={setEventListenerList:function(){return{insert:{listeners:[],listenersOnce:[]},update:{listeners:[],listenersOnce:[]},delete:{listeners:[],listenersOnce:[]},change:{listeners:[],listenersOnce:[]}}},fire:function(e,t,n){var r;if(e[t]){for(r=0;r<e[t].listeners.length;r++)e[t].listeners[r](n);for(r=0;r<e[t].listenersOnce.length;r++)e[t].listenersOnce[r](n);e[t].listenersOnce.splice(0,e[t].listenersOnce.length)}},addEventListener:function(e,t,n){K(e,t,n)&&e[t].listeners.push(n)},addOneTimeEventListener:function(e,t,n){K(e,t,n)&&e[t].listenersOnce.push(n)},removeEventListener:function(e,t,n){var r;K(e,t,n)&&0<=(r=e[t].listeners.indexOf(n))&&e[t].listeners.splice(r,1)}},P.Geo={lawOfHaversines:function(e,t){return n=e,i=(r=t).coordinates[0],o=(n.coordinates[0]-i)*(Math.PI/180),a=r.coordinates[1]*(Math.PI/180),s=n.coordinates[1]*(Math.PI/180),c=s-a,u=Math.sin(c/2)*Math.sin(c/2)+Math.cos(a)*Math.cos(s)*Math.sin(o/2)*Math.sin(o/2),6371e3*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)));var n,r,i,o,a,s,c,u},lawOfCosines:da,equirectangularProjection:function(e,t){return n=e,i=(r=t).coordinates[0]*(Math.PI/180),o=n.coordinates[0]*(Math.PI/180),a=r.coordinates[1]*(Math.PI/180),s=n.coordinates[1]*(Math.PI/180),c=(o-i)*Math.cos((a+s)/2),u=s-a,6371e3*Math.sqrt(c*c+u*u);var n,r,i,o,a,s,c,u},query:xa},P.Project={setProjection:function(e,t){return!t||void 0!==e._id?e:_.extend({_id:1},e)},isProjectionTypeInclude:function(e){var t;for(t in e)if(_.isObject(e[t])){if(this.isProjectionTypeInclude(e[t]))return!0}else if(e[t])return!0;return!1},add:function(e,t,n){_.isEmpty(n.value)?e.push(_.clone(t)):n.type?e.push(function t(n,r,i){return _.forPropIn(r,function(e){n[e]&&(_.isObject(r[e])?(i[e]={},t(n[e],r[e],i[e])):1===r[e]&&(_.isObject(n[e])?i[e]=_.clone(n[e]):n[e]&&(i[e]=n[e])))}),i}(t,n.value,{})):e.push(function t(n,r,i){return _.forPropIn(n,function(e){void 0!==r[e]?_.isObject(r[e])&&(i[e]={},t(n[e],r[e],i[e])):_.isObject(n[e])?i[e]=_.clone(n[e]):i[e]=n[e]}),i}(t,n.value,{}))}},Rc=P.Geo,P.Query={isHavingSpecialOperator:Uc,isMatch:function(e,t,n){var r;if(!n.or)return Xc(e,t,n);for(r=0;r<t.$or.length;r++)if(Xc(e,t.$or[r],n))return!0;return!1}},Cd=P.Query,P.Count={count:function(e,t,n,r){var i=e.db;(!r||_.isFunction(r))&&(r||_.isFunction(n))?!r&&_.isFunction(n)&&(r=n,n={}):r=void 0,!_.isArray(n)&&_.isObject(n)||(n={}),function(e,t,n){var r,i,o=Cd.isHavingSpecialOperator(t);if(!_.isObject(t)||_.isArray(t)||_.isFunction(t))n&&n("query is not a valid object!",0);else{for(i=r=0;i<e.data.length;i++)Cd.isMatch(e.data[i],t,o)&&(r+=1);n&&n(null,r)}}(i,t,r)}},Qd=P.Event,Rd=P.Query,P.Delete={delete:function(e,t,n,r,i){var o=e.db,a=e.eventQ;(!i||_.isFunction(i))&&(i||_.isFunction(r))?!i&&_.isFunction(r)&&(i=r,r={}):i=void 0,!_.isArray(r)&&_.isObject(r)||(r={}),r.many=t,function(e,t,n,r,i){var o,a,s,c,u=Rd.isHavingSpecialOperator(n);if(_.isObject(n)&&!_.isArray(n)){if(_.isEmpty(n))return s=[],r.many?(o=e.data.length,s=_.clone(e.data),e.data.length=0):(o=1,s=e.data.splice(0,1)),Qd.fire(t,"change",s),Qd.fire(t,"delete",s),i&&i(null,o);for(o=0,s=[],a=e.data.length,c=0;c<a&&(!Rd.isMatch(e.data[c],n,u)||(s.push(e.data.splice(c,1)),o+=1,--c,--a,r.many));c++);Qd.fire(t,"change",s),Qd.fire(t,"delete",s),i&&i(null,o)}else i&&i(null,null)}(o,a,n,r,i)}},ie=P.Query,je=P.Project,P.Find={find:function(e,t,n){var r;e.cursor||(e.cursor={query:{},projection:{type:null,value:null}}),(r=e.cursor).query=!_.isArray(t)&&_.isObject(t)?t:{},!_.isArray(n)&&_.isObject(n)?(r.projection.type=je.isProjectionTypeInclude(n),r.projection.value=je.setProjection(n,r.projection.type)):r.projection.value={}},toArray:function(e,t){_.isFunction(t)&&function(e,t){var n,r,i=e.cursor.query,o=e.cursor.projection,a=e.db,s=ie.isHavingSpecialOperator(i);if(_.isArray(i)||_.isFunction(i)||!_.isObject(i))t("This query isn't a valid Cursor query object");else{for(n=[],r=0;r<a.data.length;r++)ie.isMatch(a.data[r],i,s)&&je.add(n,a.data[r],o);t(null,n)}}(e,t)}},Ae=P.Event,P.Insert={schema:function(){return{data:[]}},insert:function(e,t,n,r,i){var o=e.db,a=e.eventQ;(!i||_.isFunction(i))&&(i||_.isFunction(r))?!i&&_.isFunction(r)&&(i=r,r={}):i=void 0,!_.isArray(r)&&_.isObject(r)||(r={}),r.many=t,(_.isArray(n)||_.isObject(n))&&De(o,a,n,r,i)}},P.Update={update:function(e,t,n,r,i,o){var a=e.db,s=e.eventQ;(!o||_.isFunction(o))&&(o||_.isFunction(i))?!o&&_.isFunction(i)&&(o=i,i={}):o=void 0,!_.isArray(i)&&_.isObject(i)||(i={}),i.many=t,function(e,t,n,r,i,o){var a,s,c=P.Query.isHavingSpecialOperator(n);if(_.isArray(n)||_.isFunction(n)||!_.isObject(n))o&&o("filter is not a valid object!");else if(_.isArray(r)||_.isFunction(r)||!_.isObject(r))o&&o("update is not a valid object!");else{for(a=[],s=0;s<e.data.length&&(!P.Query.isMatch(e.data[s],n,c)||(bf(e.data[s],r),a.push(_.extend({},e.data[s])),i.many));s++);P.Event.fire(t,"change",a),P.Event.fire(t,"update",a),o&&o(null,a)}}(a,s,n,r,i,o)}},function(){var Event=P.Event,Insert=P.Insert,Count=P.Count,Delete=P.Delete,Update=P.Update,Find=P.Find,methods,previousPicoDB;PicoDB=function(){var e=Object.create(methods);return e.db=Insert.schema(),e.eventQ=Event.setEventListenerList(),e},previousPicoDB=root.PicoDB,PicoDB.noConflict=function(){return root.PicoDB=previousPicoDB,this},PicoDB.VERSION="0.12.2",methods={_export:function(name){return eval(name)},count:function(e,t,n){!this.db||arguments.length<1||Count.count(this,e,t,n)},deleteMany:function(e,t,n){!this.db||arguments.length<1||Delete.delete(this,!0,e,t,n)},deleteOne:function(e,t,n){!this.db||arguments.length<1||Delete.delete(this,!1,e,t,n)},insertMany:function(e,t,n){arguments.length<1||Insert.insert(this,!0,e,t,n)},insertOne:function(e,t,n){arguments.length<1||Insert.insert(this,!1,e,t,n)},updateMany:function(e,t,n,r){!this.db||arguments.length<2||Update.update(this,!0,e,t,n,r)},updateOne:function(e,t,n,r){!this.db||arguments.length<2||Update.update(this,!1,e,t,n,r)},find:function(e,t){return e=e||{},t=t||{},Find.find(this,e,t),this},toArray:function(e){Find.toArray(this,e)},addEventListener:function(e,t){Event.addEventListener(this.eventQ,e,t)},addOneTimeEventListener:function(e,t){Event.addOneTimeEventListener(this.eventQ,e,t)},removeEventListener:function(e,t){Event.removeEventListener(this.eventQ,e,t)},on:function(e,t){this.addEventListener(e,t)},one:function(e,t){this.addOneTimeEventListener(e,t)},off:function(e,t){this.removeEventListener(e,t)}}}(),PicoDB});